!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators"),require("rxjs/internal/observable/throwError")):"function"==typeof define&&define.amd?define("abp-ng2-module",["exports","@angular/core","@angular/common/http","rxjs","rxjs/operators","rxjs/internal/observable/throwError"],t):t((e=e||self)["abp-ng2-module"]={},e.ng.core,e.ng.common.http,e.rxjs,e.rxjs.operators,e.rxjs["internal/observable/throwError"])}(this,(function(e,t,r,n,o,i){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function a(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}var u=function(){function e(){}return e=a([t.NgModule({declarations:[],imports:[],exports:[]})],e)}(),s=function(){function e(){}return e.prototype.getToken=function(){return abp.auth.getToken()},e.prototype.getTokenCookieName=function(){return abp.auth.tokenCookieName},e.prototype.clearToken=function(){abp.auth.clearToken()},e.prototype.setToken=function(e,t){abp.auth.setToken(e,t)},e.prototype.getRefreshToken=function(){return abp.auth.getRefreshToken()},e.prototype.getRefreshTokenCookieName=function(){return abp.auth.refreshTokenCookieName},e.prototype.clearRefreshToken=function(){abp.auth.clearRefreshToken()},e.prototype.setRefreshToken=function(e,t){abp.auth.setRefreshToken(e,t)},e.ɵprov=t["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=a([t.Injectable({providedIn:"root"})],e)}(),p=function(){function e(){}return e.prototype.isGranted=function(e){return abp.auth.isGranted(e)},e.ɵprov=t["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=a([t.Injectable({providedIn:"root"})],e)}(),c=function(){function e(){}return e.prototype.get=function(e){return abp.features.get(e)},e.prototype.getValue=function(e){return abp.features.getValue(e)},e.prototype.isEnabled=function(e){return abp.features.isEnabled(e)},e.ɵprov=t["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=a([t.Injectable({providedIn:"root"})],e)}(),f=function(){function e(){}return Object.defineProperty(e.prototype,"languages",{get:function(){return abp.localization.languages},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentLanguage",{get:function(){return abp.localization.currentLanguage},enumerable:!0,configurable:!0}),e.prototype.localize=function(e,t){return abp.localization.localize(e,t)},e.prototype.getSource=function(e){return abp.localization.getSource(e)},e.ɵprov=t["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=a([t.Injectable({providedIn:"root"})],e)}(),l=function(){function e(){}return e.prototype.debug=function(e){abp.log.debug(e)},e.prototype.info=function(e){abp.log.info(e)},e.prototype.warn=function(e){abp.log.warn(e)},e.prototype.error=function(e){abp.log.error(e)},e.prototype.fatal=function(e){abp.log.fatal(e)},e.ɵprov=t["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=a([t.Injectable({providedIn:"root"})],e)}(),d=function(){function e(){}return e.prototype.info=function(e,t,r){return abp.message.info(e,t,r)},e.prototype.success=function(e,t,r){return abp.message.success(e,t,r)},e.prototype.warn=function(e,t,r){return abp.message.warn(e,t,r)},e.prototype.error=function(e,t,r){return abp.message.error(e,t,r)},e.prototype.confirm=function(e,t,r,n){return abp.message.confirm(e,t,r,n)},e.ɵprov=t["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=a([t.Injectable({providedIn:"root"})],e)}(),h=function(){function e(){}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return abp.multiTenancy.isEnabled},enumerable:!0,configurable:!0}),e.ɵprov=t["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=a([t.Injectable({providedIn:"root"})],e)}(),b=function(){function e(){}return e.prototype.info=function(e,t,r){abp.notify.info(e,t,r)},e.prototype.success=function(e,t,r){abp.notify.success(e,t,r)},e.prototype.warn=function(e,t,r){abp.notify.warn(e,t,r)},e.prototype.error=function(e,t,r){abp.notify.error(e,t,r)},e.ɵprov=t["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=a([t.Injectable({providedIn:"root"})],e)}(),g=function(){function e(){}return Object.defineProperty(e.prototype,"userId",{get:function(){return abp.session.userId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tenantId",{get:function(){return abp.session.tenantId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"impersonatorUserId",{get:function(){return abp.session.impersonatorUserId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"impersonatorTenantId",{get:function(){return abp.session.impersonatorTenantId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiTenancySide",{get:function(){return abp.session.multiTenancySide},enumerable:!0,configurable:!0}),e.ɵprov=t["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=a([t.Injectable({providedIn:"root"})],e)}(),y=function(){function e(){}return e.prototype.get=function(e){return abp.setting.get(e)},e.prototype.getBoolean=function(e){return abp.setting.getBoolean(e)},e.prototype.getInt=function(e){return abp.setting.getInt(e)},e.ɵprov=t["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=a([t.Injectable({providedIn:"root"})],e)}(),v=function(){function e(){}return e.prototype.getCookieValue=function(e){return abp.utils.getCookieValue(e)},e.prototype.setCookieValue=function(e,t,r,n,o,i){abp.utils.setCookieValue(e,t,r,n,o,i)},e.prototype.deleteCookie=function(e,t){abp.utils.deleteCookie(e,t)},e.ɵprov=t["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=a([t.Injectable({providedIn:"root"})],e)}(),m=function(){function e(e){this._http=e}return e.prototype.initialize=function(){this._http.get("/AbpUserConfiguration/GetAll").subscribe((function(e){jQuery.extend(!0,abp,JSON.parse(JSON.stringify(e)))}))},e.ctorParameters=function(){return[{type:r.HttpClient}]},e.ɵprov=t["ɵɵdefineInjectable"]({factory:function(){return new e(t["ɵɵinject"](r.HttpClient))},token:e,providedIn:"root"}),e=a([t.Injectable({providedIn:"root"})],e)}(),I=function(){function e(e,t){this._messageService=e,this._logService=t,this.defaultError={message:"An error has occurred!",details:"Error details were not sent by server."},this.defaultError401={message:"You are not authenticated!",details:"You should be authenticated (sign in) in order to perform this operation."},this.defaultError403={message:"You are not authorized!",details:"You are not allowed to perform this operation."},this.defaultError404={message:"Resource not found!",details:"The resource requested could not be found on the server."}}return e.prototype.logError=function(e){this._logService.error(e)},e.prototype.showError=function(e){return e.details?this._messageService.error(e.details,e.message||this.defaultError.message):this._messageService.error(e.message||this.defaultError.message)},e.prototype.handleTargetUrl=function(e){location.href=e||"/"},e.prototype.handleUnAuthorizedRequest=function(e,t){var r=this;e?e.done((function(){r.handleTargetUrl(t||"/")})):this.handleTargetUrl(t||"/")},e.prototype.handleNonAbpErrorResponse=function(e){switch(e.status){case 401:this.handleUnAuthorizedRequest(this.showError(this.defaultError401),"/");break;case 403:this.showError(this.defaultError403);break;case 404:this.showError(this.defaultError404);break;default:this.showError(this.defaultError)}},e.prototype.handleAbpResponse=function(e,t){var r;return t.success?(r=e.clone({body:t.result}),t.targetUrl&&this.handleTargetUrl(t.targetUrl)):(r=e.clone({body:t.result}),t.error||(t.error=this.defaultError),this.logError(t.error),this.showError(t.error),401===e.status&&this.handleUnAuthorizedRequest(null,t.targetUrl)),r},e.prototype.getAbpAjaxResponseOrNull=function(e){if(!e||!e.headers)return null;var t=e.headers.get("Content-Type");if(!t)return this._logService.warn("Content-Type is not sent!"),null;if(t.indexOf("application/json")<0)return this._logService.warn("Content-Type is not application/json: "+t),null;var r=JSON.parse(JSON.stringify(e.body));return r.__abp?r:null},e.prototype.handleResponse=function(e){var t=this.getAbpAjaxResponseOrNull(e);return null==t?e:this.handleAbpResponse(e,t)},e.prototype.blobToText=function(e){return new n.Observable((function(t){if(e){var r=new FileReader;r.onload=function(){t.next(this.result),t.complete()},r.readAsText(e)}else t.next(""),t.complete()}))},e.ctorParameters=function(){return[{type:d},{type:l}]},e.ɵprov=t["ɵɵdefineInjectable"]({factory:function(){return new e(t["ɵɵinject"](d),t["ɵɵinject"](l))},token:e,providedIn:"root"}),e=a([t.Injectable({providedIn:"root"})],e)}(),j=function(){function e(){}return e=a([t.Injectable()],e)}(),k=function(){function e(e,t){this._injector=t,this._tokenService=new s,this._utilsService=new v,this._logService=new l,this.isRefreshing=!1,this.refreshTokenSubject=new n.BehaviorSubject(null),this.configuration=e}return e.prototype.intercept=function(e,t){var n=this,i=this.normalizeRequestHeaders(e);return t.handle(i).pipe(o.catchError((function(o){return o instanceof r.HttpErrorResponse&&401===o.status?n.tryAuthWithRefreshToken(e,t,o):n.handleErrorResponse(o)})),o.switchMap((function(e){return n.handleSuccessResponse(e)})))},e.prototype.tryGetRefreshTokenService=function(){var e=this._injector.get(j,null);return e?e.tryAuthWithRefreshToken():n.of(!1)},e.prototype.tryAuthWithRefreshToken=function(e,t,r){var n=this;return this.isRefreshing?this.refreshTokenSubject.pipe(o.filter((function(e){return null!=e})),o.take(1),o.switchMap((function(r){var o=n.normalizeRequestHeaders(e);return t.handle(o)}))):(this.isRefreshing=!0,this.refreshTokenSubject.next(null),this.tryGetRefreshTokenService().pipe(o.switchMap((function(o){if(n.isRefreshing=!1,o){n.refreshTokenSubject.next(o);var i=n.normalizeRequestHeaders(e);return t.handle(i)}return n.handleErrorResponse(r)}))))},e.prototype.normalizeRequestHeaders=function(e){var t=new r.HttpHeaders;return t=e.headers.set("Pragma","no-cache").set("Cache-Control","no-cache").set("Expires","Sat, 01 Jan 2000 00:00:00 GMT"),t=this.addXRequestedWithHeader(t),t=this.addAuthorizationHeaders(t),t=this.addAspNetCoreCultureHeader(t),t=this.addAcceptLanguageHeader(t),t=this.addTenantIdHeader(t),e.clone({headers:t})},e.prototype.addXRequestedWithHeader=function(e){return e&&(e=e.set("X-Requested-With","XMLHttpRequest")),e},e.prototype.addAspNetCoreCultureHeader=function(e){var t=this._utilsService.getCookieValue("Abp.Localization.CultureName");return t&&e&&!e.has(".AspNetCore.Culture")&&(e=e.set(".AspNetCore.Culture",t)),e},e.prototype.addAcceptLanguageHeader=function(e){var t=this._utilsService.getCookieValue("Abp.Localization.CultureName");return t&&e&&!e.has("Accept-Language")&&(e=e.set("Accept-Language",t)),e},e.prototype.addTenantIdHeader=function(e){var t=this._utilsService.getCookieValue(abp.multiTenancy.tenantIdCookieName);return t&&e&&!e.has(abp.multiTenancy.tenantIdCookieName)&&(e=e.set(abp.multiTenancy.tenantIdCookieName,t)),e},e.prototype.addAuthorizationHeaders=function(e){var t=e?e.getAll("Authorization"):null;if(t||(t=[]),!this.itemExists(t,(function(e){return 0==e.indexOf("Bearer ")}))){var r=this._tokenService.getToken();e&&r&&(e=e.set("Authorization","Bearer "+r))}return e},e.prototype.handleSuccessResponse=function(e){var t=this;return e instanceof r.HttpResponse&&e.body instanceof Blob&&e.body.type&&e.body.type.indexOf("application/json")>=0?t.configuration.blobToText(e.body).pipe(o.map((function(r){var n="null"==r?{}:JSON.parse(r),o=t.configuration.handleResponse(e.clone({body:n}));return o.clone({body:new Blob([JSON.stringify(o.body)],{type:"application/json"})})}))):n.of(e)},e.prototype.handleErrorResponse=function(e){var t=this;return e.error instanceof Blob?this.configuration.blobToText(e.error).pipe(o.switchMap((function(n){var o=""==n||"null"==n?{}:JSON.parse(n),a=new r.HttpResponse({headers:e.headers,status:e.status,body:o}),u=t.configuration.getAbpAjaxResponseOrNull(a);return null!=u?t.configuration.handleAbpResponse(a,u):t.configuration.handleNonAbpErrorResponse(a),i.throwError(e)}))):i.throwError(e)},e.prototype.itemExists=function(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return!0;return!1},e.ctorParameters=function(){return[{type:I},{type:t.Injector}]},e=a([t.Injectable()],e)}();e.AbpHttpConfigurationService=I,e.AbpHttpInterceptor=k,e.AbpModule=u,e.AbpMultiTenancyService=h,e.AbpSessionService=g,e.AbpUserConfigurationService=m,e.FeatureCheckerService=c,e.LocalizationService=f,e.LogService=l,e.MessageService=d,e.NotifyService=b,e.PermissionCheckerService=p,e.RefreshTokenService=j,e.SettingService=y,e.TokenService=s,e.UtilsService=v,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=abp-ng2-module.umd.min.js.map